---
import SiteLayout from '../layouts/SiteLayout.astro';
import { getPublishedPosts, getPageSlice, totalPages, PAGE_SIZE } from '../lib/posts';

const posts = await getPublishedPosts();
const pagePosts = getPageSlice(posts, 1);
const total = totalPages(posts);
const fmt = new Intl.DateTimeFormat('en-US', { dateStyle: 'medium' });
---

<SiteLayout title="jz's Blog" description="Writing, notes, and reflections by jz.">

	<section aria-label="Latest posts" class="posts">
		{pagePosts.length === 0 && <p>No posts yet.</p>}
		{pagePosts.map((post) => (
			<article class="card">
				<div class="card__head">
					<h2>
						<a class="title-link" href={`/blog/${post.slug}/`}>{post.data.title}</a>
					</h2>
					<div class="dates">
						<span>{fmt.format(post.data.published)}</span>
					</div>
				</div>
				<p class="description">{post.data.description}</p>
			</article>
		))}
	</section>

	{total > 1 && (
		<div class="pagination">
			<a class="older" href="/blog/2/">Older posts →</a>
			<p>{PAGE_SIZE} per page · {total} page{total === 1 ? '' : 's'}</p>
		</div>
	)}
</SiteLayout>

<style>
	.hero {
		margin-bottom: 1.5rem;
	}
	h1 {
		margin: 0;
		font-size: clamp(2.2rem, 6vw, 2.8rem);
	}
	.posts {
		display: grid;
		gap: 1rem;
	}
	.card {
		padding: 0.4rem 0;
	}
	.card__head {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 1rem;
		margin-bottom: 0.6rem;
	}
	.card h2 {
		margin: 0;
		font-size: 1.35rem;
		color: #0f172a;
		text-decoration: underline;
	}
	.title-link {
		color: inherit;
	}
	.dates {
		color: #475569;
		font-size: 0.95rem;
		display: flex;
		gap: 0.9rem;
		flex-wrap: wrap;
		text-decoration: none;
	}
	.description {
		margin: 0;
		color: #0f172a;
		line-height: 1.5;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
		text-decoration: none;
	}
	.pagination {
		margin-top: 1.25rem;
		display: flex;
		align-items: center;
		gap: 0.75rem;
		color: #475569;
	}
	.older {
		color: #2563eb;
		font-weight: 600;
	}
	@media (max-width: 680px) {
		.card__head {
			flex-direction: column;
			align-items: flex-start;
		}
	}
</style>
